{{ $link := .Destination }}
{{ $text := .Text }}
{{ $title := .Title }}

{{/* Convert internal paths if needed */}}
{{ if not (or (hasPrefix $link "http://") (hasPrefix $link "https://") (hasPrefix $link "#") (hasPrefix $link "/")) }}
  {{/* This might be an internal link to a page */}}
  {{/* Convert spaces to hyphens and lowercase */}}
  {{ $convertedLink := replace $link " " "-" }}
  {{ $convertedLink = lower $convertedLink }}
  
  {{/* Add trailing slash for Hugo permalink consistency */}}
  {{ if not (hasSuffix $convertedLink "/") }}
    {{ $convertedLink = print $convertedLink "/" }}
  {{ end }}
  
  {{/* Add leading slash for absolute URL */}}
  {{ if not (hasPrefix $convertedLink "/") }}
    {{ $convertedLink = print "/" $convertedLink }}
  {{ end }}
  
  {{ $link = $convertedLink }}
{{ end }}

{{/* Regular rendering for links */}}
<a href="{{ $link | safeURL }}"{{ with $title}} title="{{ . }}"{{ end }}{{ if or (hasPrefix $link "http://") (hasPrefix $link "https://") }} target="_blank" rel="noopener"{{ end }}>{{ $text }}</a> 